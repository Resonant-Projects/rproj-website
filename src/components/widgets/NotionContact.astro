---
/**
 * NotionContact - Contact form with Astro Actions + React useActionState
 *
 * Uses the modern pattern from: https://www.youtube.com/watch?v=-0pbaYcQJ-0
 * - Astro Actions for type-safe server-side form handling
 * - React useActionState for client-side state management
 * - Built-in pending states and error handling
 * - Progressive enhancement with graceful degradation
 */
import type { Input } from '~/types';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import { ContactFormReact } from './ContactFormReact';

interface Props {
  defaultService?: string;
  id?: string;
  isDark?: boolean;
  classes?: { container?: string };
  bg?: string;
}

const { defaultService = '', id, isDark = false, classes = {}, bg } = Astro.props;

const inputs: Array<Input> = [
  {
    name: 'name',
    label: 'Name',
    type: 'text',
    required: true,
    placeholder: 'Your name',
  },
  {
    name: 'email',
    label: 'Email',
    type: 'email',
    required: true,
    placeholder: 'you@email.com',
  },
  {
    name: 'service',
    label: 'Service',
    type: 'select',
    required: true,
    options: [
      { value: '', label: 'Select a service' },
      { value: 'Design', label: 'Design' },
      { value: 'Rhythm', label: 'Rhythm' },
      { value: 'Color', label: 'Color' },
      { value: 'Motion', label: 'Motion' },
    ],
    defaultValue: defaultService,
  },
];

const textarea = {
  name: 'message',
  label: 'Message',
  required: true,
  placeholder: 'Share your ideas, questions, or goals with us!',
};

const button = 'Start the Conversation';

const title = 'Ready to Start Your Project?';
const subtitle = "Tell us about your vision. We'll respond within 24 hours with next steps.";
const description = "Share your goals and we'll show you exactly how we can help. No pressure, just honest advice.";
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} />

  <!-- React component with client:load for immediate hydration -->
  <ContactFormReact
    client:load
    title=""
    subtitle=""
    inputs={inputs}
    textarea={textarea}
    button={button}
    description={description}
  />
</WidgetWrapper>

<!-- Progressive Enhancement: Form works without JS via noscript fallback -->
<noscript>
  <style>
    /* Hide React form container when JS is disabled, show fallback */
    #notion-contact-form {
      display: none !important;
    }
  </style>
  <div class="mx-auto max-w-xl rounded-lg border border-amber-200 bg-amber-50 p-4 text-center text-amber-800">
    <p class="mb-2 font-medium">JavaScript Required</p>
    <p class="text-sm">
      Please enable JavaScript to use the contact form, or email us directly at <a
        href="mailto:info@rproj.art"
        class="underline">info@rproj.art</a
      >
    </p>
  </div>
</noscript>
